<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>ğŸƒ Ğ”ÑƒÑ€Ğ°Ğº</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{background:#0b5c2d;color:#fff;font-family:Arial;text-align:center}
#hand{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.card{width:60px;height:90px;background:#fff;color:#000;border-radius:8px;
display:flex;align-items:center;justify-content:center;cursor:pointer}
button{padding:8px 14px;font-size:16px;margin:4px}
</style>
</head>
<body>

<h1>ğŸƒ Ğ”ÑƒÑ€Ğ°Ğº</h1>
<div id="info"></div>
<div id="trump"></div>
<div id="table"></div>
<div id="hand"></div>

<button id="bito" style="display:none">Ğ‘Ğ¸Ñ‚Ğ¾</button>
<button id="take" style="display:none">Ğ—Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ</button>

<script>
const WSS_URL="wss://durak-server-pfxg.onrender.com";
const tg=window.Telegram.WebApp; tg.ready();
const user=tg.initDataUnsafe.user;
const ws=new WebSocket(WSS_URL);

let hand=[], phase="", yourTurn=false, table={};

ws.onopen=()=>ws.send(JSON.stringify({type:"join",playerId:user.id}));

ws.onmessage=e=>{
  const d=JSON.parse(e.data);

  if(d.type==="state"){
    hand=d.hand; phase=d.phase; yourTurn=d.yourTurn; table=d.table;
    document.getElementById("trump").innerText="ĞšĞ¾Ğ·Ñ‹Ñ€ÑŒ: "+d.trump;
    render();
  }

  if(d.type==="update"){
    table=d.table;
    render();
  }
};

function render(){
  document.getElementById("info").innerText =
    phase==="attack" ? (yourTurn?"Ğ¢Ğ²Ğ¾Ğ¹ Ñ…Ğ¾Ğ´":"Ğ¥Ğ¾Ğ´ ÑĞ¾Ğ¿ĞµÑ€Ğ½Ğ¸ĞºĞ°")
    : phase==="defense" ? (yourTurn?"Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ğ°Ğ¹ÑÑ":"Ğ¡Ğ¾Ğ¿ĞµÑ€Ğ½Ğ¸Ğº Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ÑÑ")
    : "";

  const t=document.getElementById("table");
  t.innerHTML="";
  if(table.attack) t.innerHTML+=table.attack.rank+table.attack.suit+" ";
  if(table.defense) t.innerHTML+=table.defense.rank+table.defense.suit;

  const h=document.getElementById("hand"); h.innerHTML="";
  hand.forEach(c=>{
    const el=document.createElement("div");
    el.className="card";
    el.innerText=c.rank+c.suit;
    el.onclick=()=>{
      if(!yourTurn) return;
      if(phase==="attack") ws.send(JSON.stringify({type:"attack",card:c}));
      if(phase==="defense") ws.send(JSON.stringify({type:"defend",card:c}));
    };
    h.appendChild(el);
  });

  document.getElementById("bito").style.display =
    (phase==="defense" && !yourTurn) ? "inline-block":"none";

  document.getElementById("take").style.display =
    (phase==="defense" && yourTurn) ? "inline-block":"none";
}

document.getElementById("bito").onclick=()=>{
  ws.send(JSON.stringify({type:"bito"}));
};
document.getElementById("take").onclick=()=>{
  ws.send(JSON.stringify({type:"take"}));
};
</script>

</body>
</html>
