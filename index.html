<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Durak Core</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{background:#0b5c2d;color:#fff;font-family:Arial;text-align:center}
#hand{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.card{width:60px;height:90px;background:#fff;color:#000;border-radius:8px;
display:flex;align-items:center;justify-content:center;cursor:pointer}
</style>
</head>
<body>

<h2>ğŸƒ Durak Core</h2>
<div id="status"></div>
<div id="trump"></div>
<div id="table"></div>
<div id="hand"></div>

<script>
const WSS_URL="wss://durak-server-pfxg.onrender.com";
const tg=window.Telegram.WebApp; tg.ready();
const user=tg.initDataUnsafe.user;
const ws=new WebSocket(WSS_URL);

let hands={}, attack=null, defense=null, turn=null;

ws.onopen=()=>{
  ws.send(JSON.stringify({type:"join",playerId:user.id}));
};

ws.onmessage=e=>{
  const s=JSON.parse(e.data);
  hands=s.hands;
  attack=s.attack;
  defense=s.defense;
  turn=s.turn;

  document.getElementById("trump").innerText="ĞšĞ¾Ğ·Ñ‹Ñ€ÑŒ: "+s.trump;
  document.getElementById("status").innerText=
    turn===user.id?"Ğ¢Ğ²Ğ¾Ğ¹ Ñ…Ğ¾Ğ´":"Ğ¥Ğ¾Ğ´ ÑĞ¾Ğ¿ĞµÑ€Ğ½Ğ¸ĞºĞ°";

  const t=document.getElementById("table");
  t.innerHTML="";
  if(attack) t.innerHTML+=attack.rank+attack.suit+" ";
  if(defense) t.innerHTML+=defense.rank+defense.suit;

  const h=document.getElementById("hand");
  h.innerHTML="";
  (hands[user.id]||[]).forEach(c=>{
    const el=document.createElement("div");
    el.className="card";
    el.innerText=c.rank+c.suit;
    el.onclick=()=>{
      ws.send(JSON.stringify({
        type: attack?"defend":"attack",
        card:c
      }));
    };
    h.appendChild(el);
  });
};
</script>

</body>
</html>
